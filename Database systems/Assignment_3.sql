DROP TABLE ANSWER01;
DROP TABLE ANSWER02;
DROP TABLE ANSWER03;
DROP TABLE ANSWER04;
DROP TABLE ANSWER05;
DROP TABLE ANSWER06;
DROP TABLE ANSWER07;


DROP TABLE TEMP0;
DROP TABLE TEMP1;
DROP TABLE TEMP2;
DROP TABLE TEMP3;
DROP TABLE TEMP4;
DROP TABLE TEMP5;
DROP TABLE TEMP6;
DROP TABLE TEMP7;
DROP TABLE TEMP8;
DROP TABLE TEMP9;
DROP TABLE TEMP10;
DROP TABLE TEMP11;
DROP TABLE TEMP12;
DROP TABLE TEMP13;
DROP TABLE TEMP14;
DROP TABLE TEMP15;
DROP TABLE TEMP16;
DROP TABLE TEMP17;
DROP TABLE TEMP18;
DROP TABLE TEMP19;
DROP TABLE TEMP20;

DROP TABLE ADVISES;
DROP TABLE BORROWS;
DROP TABLE LIBRARIAN;
DROP TABLE PATRON;
DROP TABLE PERSON;
DROP TABLE AUTHOR;
DROP TABLE COPY;
DROP TABLE BOOK;
DROP TABLE CITY;
DROP TABLE PUBLISHER;


CREATE TABLE PERSON(
	LNUMBER CHAR(30) PRIMARY KEY,
	NAME CHAR(30) NOT NULL,
	EMAIL CHAR(30)
);

CREATE TABLE LIBRARIAN(
	LNUMBER CHAR(30) PRIMARY KEY,
	SALARY CHAR(30),
	SSN CHAR(30) NOT NULL,
	SUPERVISOR CHAR(30),
	FOREIGN KEY(LNUMBER) REFERENCES PERSON(LNUMBER) ON DELETE CASCADE 
);

CREATE TABLE PATRON(
	LNUMBER CHAR(30) PRIMARY KEY,
	TYPE CHAR(30) NOT NULL,
	VALUE CHAR(30) NOT NULL,
	FOREIGN KEY(LNUMBER) REFERENCES PERSON(LNUMBER) ON DELETE CASCADE	
);

CREATE TABLE ADVISES(
	LIBRARIAN CHAR(30),
	PATRON CHAR(30),
	LATESTDATE DATE NOT NULL,
	PRIMARY KEY(LIBRARIAN, PATRON),
	FOREIGN KEY(LIBRARIAN) REFERENCES LIBRARIAN(LNUMBER) ON DELETE CASCADE,
	FOREIGN KEY(PATRON) REFERENCES PATRON(LNUMBER) ON DELETE CASCADE
);


CREATE TABLE CITY(
	NAME CHAR(30),
	STATE CHAR(30),
	PRIMARY KEY(STATE, NAME)
);

CREATE TABLE PUBLISHER(
	NAME CHAR(30) PRIMARY KEY,
	EDITOR CHAR(30)
);

CREATE TABLE BOOK(
	ISBN CHAR(30),
	NAME CHAR(30) NOT NULL,
	STATE CHAR(30) NOT NULL,
	PUBNAME CHAR(30) NOT NULL,
	TITLE CHAR(30) NOT NULL,
	YEAR CHAR(30) NOT NULL,
	PRIMARY KEY(ISBN),
	FOREIGN KEY(STATE, NAME) REFERENCES CITY(STATE, NAME) ON DELETE CASCADE,
	FOREIGN KEY(PUBNAME) REFERENCES PUBLISHER(NAME) ON DELETE CASCADE
);

CREATE TABLE COPY(
	COPYNUMBER CHAR(30),
	ISBN CHAR(30),
	PRIMARY KEY(COPYNUMBER, ISBN),
	FOREIGN KEY(ISBN) REFERENCES BOOK(ISBN) ON DELETE CASCADE
);

CREATE TABLE BORROWS(
	LNUMBER CHAR(30),
	COPYNUMBER CHAR(30),
	ISBN CHAR(30),
	DUE DATE,
	PRIMARY KEY(LNUMBER, COPYNUMBER, ISBN),
	FOREIGN KEY(LNUMBER) REFERENCES PATRON(LNUMBER) ON DELETE CASCADE,
	FOREIGN KEY(COPYNUMBER, ISBN) REFERENCES COPY(COPYNUMBER, ISBN) ON DELETE CASCADE
);

CREATE TABLE AUTHOR(
	AUTHOR CHAR(30),
	ISBN CHAR(30),
	PRIMARY KEY(AUTHOR, ISBN),
	FOREIGN KEY(ISBN) REFERENCES BOOK(ISBN) ON DELETE CASCADE
);


INSERT INTO PERSON VALUES('101', 'Abigail Black', 'ablack@abc.com');
INSERT INTO PERSON VALUES('102', 'Diane Fisher', null);
INSERT INTO PERSON VALUES('103', 'Penelope Nolan', null);
INSERT INTO PERSON VALUES('104', 'Steven Lewis', 'slewis@abc.com');
INSERT INTO PERSON VALUES('105', 'Jane Ross', 'jross@abc.com');
INSERT INTO PERSON VALUES('106', 'Bernadette Morgan', null);
INSERT INTO PERSON VALUES('107', 'Lily Springer', null);
INSERT INTO PERSON VALUES('108', 'Zoe Smith', 'zsmith@abc.com');
INSERT INTO PERSON VALUES('109', 'Amanda Mackenzie', null);
INSERT INTO PERSON VALUES('110', 'Adrian Butler', 'abutler@abc.com');
INSERT INTO PERSON VALUES('111', 'Abigail Black', null);
INSERT INTO PERSON VALUES('112', 'Hannah Black', null);
INSERT INTO PERSON VALUES('113', 'Vanessa Gill', 'vgrill@abc.com');
INSERT INTO PERSON VALUES('114', 'Bella Clark', 'bclark@abc.com');
INSERT INTO PERSON VALUES('115', 'Jake Underwood', 'junderwood@abc.com');
INSERT INTO PERSON VALUES('116', 'Virgini Wright', 'vwright@abc.com');
INSERT INTO PERSON VALUES('117', 'Joseph Young', 'jyoung@abc.com');
INSERT INTO PERSON VALUES('118', 'Dorothy Miller', 'dmiller@abc.com');

INSERT INTO LIBRARIAN VALUES('101', '2000', '063224862', '105');
INSERT INTO LIBRARIAN VALUES('102', null, '612317668', null);
INSERT INTO LIBRARIAN VALUES('105', '1000', '319174164', null);
INSERT INTO LIBRARIAN VALUES('106', '1500', '937204618', '118');
INSERT INTO LIBRARIAN VALUES('109', '2000', '847905486', null);
INSERT INTO LIBRARIAN VALUES('113', null, '407204157', null);
INSERT INTO LIBRARIAN VALUES('114', null, '888570720', '106');
INSERT INTO LIBRARIAN VALUES('115', '1000', '789570268', '101');
INSERT INTO LIBRARIAN VALUES('118', null, '597392662', null);

INSERT INTO PATRON VALUES('102', 'Passport', '7830');
INSERT INTO PATRON VALUES('103', 'Passport', '5923');
INSERT INTO PATRON VALUES('107', 'Driver License', '3210');
INSERT INTO PATRON VALUES('108', 'Driver License', '4207');
INSERT INTO PATRON VALUES('109', 'Driver License', '4977');
INSERT INTO PATRON VALUES('110', 'Passport', '6092');
INSERT INTO PATRON VALUES('111', 'Passport', '9451');
INSERT INTO PATRON VALUES('104', 'Driver License', '1411');
INSERT INTO PATRON VALUES('116', 'Passport', '3809');
INSERT INTO PATRON VALUES('117', 'Driver License', '0484');
INSERT INTO PATRON VALUES('112', 'Passport', '5570');
INSERT INTO PATRON VALUES('115', 'Passport', '2395');

INSERT INTO ADVISES VALUES('105','102', TO_DATE('1/1/2017','MM/DD/YYYY'));
INSERT INTO ADVISES VALUES('115','112', TO_DATE('2/10/2017','MM/DD/YYYY'));
INSERT INTO ADVISES VALUES('113','109', TO_DATE('12/1/2016','MM/DD/YYYY'));
INSERT INTO ADVISES VALUES('106','102', TO_DATE('1/13/2017','MM/DD/YYYY'));
INSERT INTO ADVISES VALUES('109','108', TO_DATE('1/7/2017','MM/DD/YYYY'));
INSERT INTO ADVISES VALUES('105','109', TO_DATE('12/1/2016','MM/DD/YYYY'));
INSERT INTO ADVISES VALUES('109','115', TO_DATE('1/1/2016','MM/DD/YYYY'));
INSERT INTO ADVISES VALUES('114','112', TO_DATE('2/1/2017','MM/DD/YYYY'));
INSERT INTO ADVISES VALUES('101','112', TO_DATE('2/5/2017','MM/DD/YYYY'));

INSERT INTO CITY VALUES('New York City', 'New York');
INSERT INTO CITY VALUES('Anchorage', 'Alaska');
INSERT INTO CITY VALUES('Phoenix', 'Arizona');
INSERT INTO CITY VALUES('Louisville', 'Kentucky');
INSERT INTO CITY VALUES('Wichita', 'Kansas');
INSERT INTO CITY VALUES('Baltimore', 'Maryland');
INSERT INTO CITY VALUES('Seattle', 'Washington');
INSERT INTO CITY VALUES('Columbia', 'South Carolina');
INSERT INTO CITY VALUES('Philadelphia', 'Pennsylvania');
INSERT INTO CITY VALUES('Charlotte', 'North Carolina');
INSERT INTO CITY VALUES('Houston', 'Texas');
INSERT INTO CITY VALUES('Nevada', 'Las Vegas');
INSERT INTO CITY VALUES('Newark', 'New Jersey');

INSERT INTO PUBLISHER VALUES('Algonquin Press', 'Kathy Pories');
INSERT INTO PUBLISHER VALUES('FaithWords', 'Anne Goldsmith');
INSERT INTO PUBLISHER VALUES('Genesis Press', 'Niani Colom');
INSERT INTO PUBLISHER VALUES('Broadway Books', 'Ann Campbell');
INSERT INTO PUBLISHER VALUES('Harlem Moon', 'Janet Hil');
INSERT INTO PUBLISHER VALUES('Hyperion', 'Gretchen Young');
INSERT INTO PUBLISHER VALUES('Doubleday', 'Steve Rubins');
INSERT INTO PUBLISHER VALUES('Lyons Press', 'Tom McCarthy');
INSERT INTO PUBLISHER VALUES('AMinotaur', 'Kelley Ragland');
INSERT INTO PUBLISHER VALUES('William Morrow', 'Henry Ferris');
INSERT INTO PUBLISHER VALUES('Black Pearl Books', 'Crystal Parker');
INSERT INTO PUBLISHER VALUES('Biblion Publishing', 'Celeste Dickson');

INSERT INTO BOOK VALUES('1001', 'Nevada', 'Las Vegas', 'Hyperion', 'Hamlet', '2002');
INSERT INTO BOOK VALUES('1002', 'Phoenix', 'Arizona', 'Broadway Books', 'Macbeth', '1999');
INSERT INTO BOOK VALUES('1003', 'Columbia', 'South Carolina', 'William Morrow', 'Dracula', '1990');
INSERT INTO BOOK VALUES('1004', 'Seattle', 'Washington', 'AMinotaur', 'Othello', '2005');
INSERT INTO BOOK VALUES('1005', 'Baltimore', 'Maryland', 'Algonquin Press', 'Persuasion', '2004');
INSERT INTO BOOK VALUES('1006', 'Charlotte', 'North Carolina', 'Biblion Publishing', 'Night', '2008');
INSERT INTO BOOK VALUES('1007', 'Seattle', 'Washington', 'Hyperion', 'Rebecca', '2003');
INSERT INTO BOOK VALUES('1008', 'Anchorage', 'Alaska', 'Biblion Publishing', 'Emma', '2007');
INSERT INTO BOOK VALUES('1009', 'Seattle', 'Washington', 'Broadway Books', 'Heidi', '2005');
INSERT INTO BOOK VALUES('1010', 'Seattle', 'Washington', 'Broadway Books', 'Atonement', '2016');
INSERT INTO BOOK VALUES('1011', 'Baltimore', 'Maryland', 'Algonquin Press', 'Cranford', '2004');
INSERT INTO BOOK VALUES('1012', 'Phoenix', 'Arizona', 'Broadway Books', 'Matilda', '2002');
INSERT INTO BOOK VALUES('1013', 'Charlotte', 'North Carolina', 'William Morrow', 'Shogun', '2005');
INSERT INTO BOOK VALUES('1014', 'Columbia', 'South Carolina', 'Hyperion', 'Room', '2004');
INSERT INTO BOOK VALUES('1015', 'Nevada', 'Las Vegas', 'Algonquin Press', 'Carrie', '2003');
INSERT INTO BOOK VALUES('1016', 'Philadelphia', 'Pennsylvania', 'Algonquin Press', 'Otage', '2001');
INSERT INTO BOOK VALUES('1017', 'Anchorage', 'Alaska', 'Biblion Publishing', 'Mary Barton', '2005');
INSERT INTO BOOK VALUES('1018', 'Houston', 'Texas', 'Biblion Publishing', 'The Shining', '2004');
INSERT INTO BOOK VALUES('1019', 'Newark', 'New Jersey', 'AMinotaur', 'It', '2005');
INSERT INTO BOOK VALUES('1020', 'Anchorage', 'Alaska', 'Hyperion', 'The Snakes Pass', '2004');

INSERT INTO AUTHOR VALUES('William Shakespeare','1001');
INSERT INTO AUTHOR VALUES('William Shakespeare','1002');
INSERT INTO AUTHOR VALUES('Bram Stoker','1003');
INSERT INTO AUTHOR VALUES('William Shakespeare','1004');
INSERT INTO AUTHOR VALUES('Jane Austen','1005');
INSERT INTO AUTHOR VALUES('Elie Wiesel','1006');
INSERT INTO AUTHOR VALUES('Daphne du Maurier','1007');
INSERT INTO AUTHOR VALUES('Jane Austen','1008');
INSERT INTO AUTHOR VALUES('Johanna Spyri','1009');
INSERT INTO AUTHOR VALUES('Bram Stoker','1017');
INSERT INTO AUTHOR VALUES('Ian McEwan','1010');
INSERT INTO AUTHOR VALUES('Elizabeth Gaskell','1011');
INSERT INTO AUTHOR VALUES('Roald Dahl','1012');
INSERT INTO AUTHOR VALUES('James Clavell','1013');
INSERT INTO AUTHOR VALUES('Emma Donoghue','1014');
INSERT INTO AUTHOR VALUES('Stephen King','1015');
INSERT INTO AUTHOR VALUES('Elie Wiesel','1016');
INSERT INTO AUTHOR VALUES('Elizabeth Gaskell','1017');
INSERT INTO AUTHOR VALUES('Stephen King','1018');
INSERT INTO AUTHOR VALUES('Fred Potter','1008');
INSERT INTO AUTHOR VALUES('Fred Potter','1005');
INSERT INTO AUTHOR VALUES('Stephen King','1019');
INSERT INTO AUTHOR VALUES('Bram Stoker','1020');

INSERT INTO COPY VALUES('1','1001');
INSERT INTO COPY VALUES('2','1001');
INSERT INTO COPY VALUES('3','1001');
INSERT INTO COPY VALUES('1','1002');
INSERT INTO COPY VALUES('2','1002');
INSERT INTO COPY VALUES('1','1003');
INSERT INTO COPY VALUES('2','1003');
INSERT INTO COPY VALUES('3','1003');
INSERT INTO COPY VALUES('4','1003');
INSERT INTO COPY VALUES('1','1005');
INSERT INTO COPY VALUES('1','1006');
INSERT INTO COPY VALUES('2','1006');
INSERT INTO COPY VALUES('3','1006');
INSERT INTO COPY VALUES('1','1008');
INSERT INTO COPY VALUES('2','1008');
INSERT INTO COPY VALUES('3','1008');
INSERT INTO COPY VALUES('4','1008');
INSERT INTO COPY VALUES('5','1008');
INSERT INTO COPY VALUES('1','1009');
INSERT INTO COPY VALUES('2','1009');
INSERT INTO COPY VALUES('3','1009');
INSERT INTO COPY VALUES('4','1009');
INSERT INTO COPY VALUES('1','1011');
INSERT INTO COPY VALUES('1','1012');
INSERT INTO COPY VALUES('2','1012');
INSERT INTO COPY VALUES('3','1012');
INSERT INTO COPY VALUES('4','1012');
INSERT INTO COPY VALUES('5','1012');
INSERT INTO COPY VALUES('1','1013');
INSERT INTO COPY VALUES('1','1014');
INSERT INTO COPY VALUES('1','1015');
INSERT INTO COPY VALUES('2','1015');
INSERT INTO COPY VALUES('1','1016');
INSERT INTO COPY VALUES('2','1016');
INSERT INTO COPY VALUES('1','1018');
INSERT INTO COPY VALUES('1','1019');
INSERT INTO COPY VALUES('2','1019');

INSERT INTO BORROWS VALUES('103', '1', '1003', TO_DATE('1/13/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('112', '1', '1014', TO_DATE('1/10/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('111', '2', '1001', TO_DATE('3/1/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('107', '3', '1012', TO_DATE('1/5/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('112', '2', '1009', TO_DATE('1/9/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('107', '3', '1003', TO_DATE('2/16/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('115', '4', '1009', TO_DATE('2/20/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('116', '4', '1012', TO_DATE('1/1/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('104', '1', '1006', TO_DATE('2/25/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('117', '1', '1013', TO_DATE('1/1/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('112', '2', '1003', TO_DATE('3/15/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('109', '1', '1002', TO_DATE('1/19/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('115', '5', '1012', TO_DATE('1/16/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('108', '1', '1009', TO_DATE('2/28/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('107', '1', '1008', TO_DATE('1/30/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('115', '4', '1003', TO_DATE('4/9/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('111', '3', '1008', TO_DATE('2/26/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('103', '2', '1002', TO_DATE('1/18/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('102', '1', '1012', TO_DATE('2/10/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('109', '2', '1008', TO_DATE('1/26/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('104', '1', '1015', TO_DATE('3/17/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('104', '2', '1006', TO_DATE('3/10/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('103', '3', '1001', TO_DATE('4/1/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('103', '1', '1018', TO_DATE('4/5/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('111', '1', '1019', TO_DATE('4/1/2017','MM/DD/YYYY'));
INSERT INTO BORROWS VALUES('107', '1', '1016', TO_DATE('4/5/2017','MM/DD/YYYY'));

/* 1.Produce table Answer01 (Person_Lnumber, Person_Name) which contains all the persons who are both librarian and patron.*/
CREATE TABLE ANSWER01 AS
    SELECT DISTINCT p.LNUMBER AS PERSON_LNUMBER, p.NAME AS PERSON_NAME
    FROM PERSON p, LIBRARIAN l, PATRON q
    WHERE p.LNUMBER = l.LNUMBER and l.LNUMBER = q.LNUMBER
    ORDER BY p.LNUMBER ASC;

/* 2. Produce table Answer02 (Person_Name) which contains all the persons who don’t have a supervisor.*/
CREATE TABLE ANSWER02 AS
    SELECT DISTINCT p.NAME AS PERSON_NAME
    FROM PERSON p, LIBRARIAN l
    WHERE p.LNUMBER = l.LNUMBER AND l.SUPERVISOR IS NULL
    ORDER BY p.NAME ASC;

/* 3. Produce table Answer03 (Person_Name) which contains all the persons (librarians + patrons) who haven’t borrowed any books.*/
CREATE TABLE ANSWER03 AS
    SELECT DISTINCT p.NAME AS PERSON_NAME
    FROM PERSON p
    WHERE NOT EXISTS
    (SELECT b.LNUMBER
    FROM BORROWS b
    WHERE b.LNUMBER = p.LNUMBER
    )
    ORDER BY p.NAME ASC;

/* 4. Produce table Answer04 (Person_Lnumber, Num_of_Books) counts the total number of books a person has borrowed.*/
CREATE TABLE ANSWER04 AS 
    SELECT DISTINCT LNUMBER AS PERSON_LNUMBER, COUNT(LNUMBER) AS NUM_OF_BOOKS
    FROM BORROWS
    GROUP BY LNUMBER
    ORDER BY LNUMBER ASC;
    

/* 5.Produce table Answer05 (Publisher_Name, Author_Name) which contains all the Publishers and the authors of the books that they have published.*/
CREATE TABLE ANSWER05 AS
    SELECT DISTINCT b.PUBNAME AS PUBLISHER_NAME, a.AUTHOR AS AUTHOR_NAME
    FROM BOOK b, AUTHOR a
    WHERE b.ISBN = a.ISBN
    ORDER BY b.PUBNAME ASC;

/* 6.Assume that in Copy, the maximum Number of an ISBN represents the total number of physical copies stored for the book
     corresponding to that ISBN. Produce table Answer06 (Book ISBN, Num of Copies) which contains the total number of copies
     stored for each book.*/
CREATE TABLE ANSWER06 AS
    SELECT DISTINCT ISBN AS BOOK_ISBN, COUNT(ISBN) AS NUM_OF_COPIES
    FROM COPY
    GROUP BY ISBN
    ORDER BY ISBN ASC;

/* 7. Produce table Answer07 (Person Lnumber) who used Passport to borrow more at least 3 books from the library. */
CREATE TABLE ANSWER07 AS
    SELECT DISTINCT p.LNUMBER AS PERSON_LNUMBER
    FROM PATRON p, ANSWER04 a4
    WHERE p.TYPE = 'Passport' and a4.PERSON_LNUMBER = p.LNUMBER and a4.NUM_OF_BOOKS > 2
    ORDER BY p.LNUMBER ASC;

spool N12148622_Homework03Spool.txt;

SELECT * FROM ANSWER01;
SELECT * FROM ANSWER02;
SELECT * FROM ANSWER03;
SELECT * FROM ANSWER04;
SELECT * FROM ANSWER05;
SELECT * FROM ANSWER06;
SELECT * FROM ANSWER07;

spool off;











